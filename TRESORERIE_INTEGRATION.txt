/**
 * ==========================================
 * AZALS - INTÃ‰GRATION TRÃ‰SORERIE COCKPIT
 * ==========================================
 * 
 * Date : 2 janvier 2026
 * Objectif : IntÃ©grer la TrÃ©sorerie comme pilier financier du cockpit dirigeant
 * 
 * ==========================================
 * VARIABLES CSS (NON MODIFIÃ‰ES)
 * ==========================================
 * 
 * --color-primary: #1a2332        // Bleu nuit principal
 * --color-accent: #4a90e2          // Bleu accent
 * --color-danger: #ef4444          // Rouge alerte
 * --color-success: #10b981         // Vert succÃ¨s
 * --color-warning: #f59e0b         // Orange attention
 * --color-bg-main: #f8f9fb         // Fond principal
 * --color-bg-card: #ffffff         // Fond carte
 * --shadow-sm: 0 1px 2px rgba(0,0,0,0.05)
 * --shadow-md: 0 4px 6px rgba(0,0,0,0.07)
 * --spacing-md: 1rem
 * --spacing-lg: 1.5rem
 * --border-radius-md: 0.5rem
 * 
 * ==========================================
 * CHARTE GRAPHIQUE (POINTS FIXES)
 * ==========================================
 * 
 * Layout :
 *   - Sidebar verticale 240px (nav + user profile)
 *   - Main content flex:1 (header + zones)
 * 
 * Structure zonÃ©e :
 *   1. zoneCritical ðŸ”´ : Alerte dominante exclusive
 *   2. zoneTension ðŸŸ  : Points d'attention
 *   3. zoneNormal ðŸŸ¢ : Indicateurs standards
 *   4. zoneAnalysis : Graphiques
 * 
 * RÃ¨gle d'affichage :
 *   - Si ðŸ”´ prÃ©sent â†’ UNIQUEMENT zoneCritical (masque tout)
 *   - Si ðŸŸ  prÃ©sent (sans ðŸ”´) â†’ zoneTension + zoneNormal + zoneAnalysis
 *   - Sinon â†’ zoneNormal + zoneAnalysis
 * 
 * Templates de cartes :
 *   - treasuryCardTemplate (UTILISÃ‰)
 *   - accountingCardTemplate
 *   - taxCardTemplate
 *   - hrCardTemplate
 *   - criticalDecisionTemplate
 *   - chartCardTemplate
 * 
 * Bulles d'aide :
 *   - IcÃ´ne â“˜ avec attribut data-help="texte"
 *   - Affichage au survol via #helpBubble
 * 
 * ==========================================
 * API BACKEND
 * ==========================================
 * 
 * Endpoint : GET /treasury/latest
 * Headers : Authorization: Bearer {token}
 *           X-Tenant-ID: {tenant_id}
 * 
 * Response : ForecastResponse | null
 * {
 *   id: number,
 *   opening_balance: number,      // Solde actuel
 *   inflows: number,               // EntrÃ©es prÃ©vues
 *   outflows: number,              // Sorties prÃ©vues
 *   forecast_balance: number,      // PrÃ©vision J+30
 *   red_triggered: boolean,        // true si forecast_balance < 0
 *   created_at: string             // ISO date
 * }
 * 
 * Gestion des erreurs :
 *   - 401/403 â†’ { error: 'access_denied', message: 'AccÃ¨s refusÃ©' }
 *   - 204/null â†’ null (pas de donnÃ©es)
 *   - Catch â†’ { error: 'api_unavailable', message: 'Service indisponible' }
 * 
 * ==========================================
 * LOGIQUE MÃ‰TIER TRÃ‰SORERIE
 * ==========================================
 * 
 * Ã‰tats :
 *   ðŸ”´ RED (priority 0) : red_triggered = true (forecast_balance < 0)
 *      â†’ Affichage EXCLUSIF en zoneCritical
 *      â†’ Pattern dominant : Vue immersive + bouton rapport RED
 *      â†’ Masque toutes les autres zones
 * 
 *   ðŸŸ  ORANGE (priority 1) : opening_balance < 10 000â‚¬ (sans red_triggered)
 *      â†’ Affichage en zoneTension
 *      â†’ Carte avec bordure orange
 * 
 *   ðŸŸ¢ GREEN (priority 2) : opening_balance >= 10 000â‚¬
 *      â†’ Affichage en zoneNormal
 *      â†’ Carte standard
 * 
 * Bulles d'aide TrÃ©sorerie :
 *   "ðŸŸ¢ Solde > 10 000â‚¬ â€¢ ðŸŸ  Solde < 10 000â‚¬ â€¢ ðŸ”´ PrÃ©vision nÃ©gative. 
 *    La prÃ©vision J+30 intÃ¨gre les encaissements et dÃ©caissements prÃ©vus."
 * 
 * Affichage carte :
 *   - Solde actuel (primary metric)
 *   - PrÃ©vision J+30 (small metric avec classe positive/negative)
 *   - DerniÃ¨re MAJ (small metric)
 *   - Si ðŸ”´ : bouton "Examiner la dÃ©cision"
 * 
 * ==========================================
 * GESTION DES ERREURS
 * ==========================================
 * 
 * Cas 1 : API indisponible
 *   - card-error visible
 *   - Fond jaune clair (#fef3c7)
 *   - Message : "âš ï¸ Service indisponible - L'API TrÃ©sorerie ne rÃ©pond pas"
 * 
 * Cas 2 : AccÃ¨s refusÃ©
 *   - card-error visible
 *   - Fond rouge clair (#fee2e2)
 *   - Message : "ðŸ”’ AccÃ¨s refusÃ© - Droits insuffisants"
 * 
 * Cas 3 : Aucune donnÃ©e (null)
 *   - card-error visible
 *   - Message : "Aucune donnÃ©e de trÃ©sorerie disponible"
 *   - Valeurs affichÃ©es : "â€”"
 * 
 * ==========================================
 * PATTERN ðŸ”´ DOMINANT
 * ==========================================
 * 
 * Vue exclusive (cockpit-critical-view) :
 *   - critical-header : IcÃ´ne animÃ©e + titre + timestamp
 *   - critical-metric : DÃ©ficit en gros (3rem, couleur #fecaca)
 *   - critical-details : Grid 2 colonnes (solde, entrÃ©es, sorties, prÃ©vision)
 *   - critical-actions : 
 *       â€¢ Bouton principal "ðŸ“Š Consulter le rapport RED"
 *       â€¢ Bouton secondaire "ðŸ–¨ï¸ Imprimer"
 *   - critical-guidance : Message "Aucune autre information affichÃ©e"
 * 
 * Fonction : examineRedDecision('treasury', data.id)
 *   â†’ Ouvre modal showTreasuryRedPanel(data)
 *   â†’ Affiche dÃ©ficit + options de financement
 * 
 * ==========================================
 * MODIFICATIONS APPLIQUÃ‰ES
 * ==========================================
 * 
 * Fichier : /ui/app.js
 * 
 * 1. buildTreasuryModule(data) [ligne ~371]
 *    - âœ… GÃ¨re data.error (API indisponible, accÃ¨s refusÃ©)
 *    - âœ… GÃ¨re data = null (pas de donnÃ©es)
 *    - âœ… Calcule priority/status selon red_triggered et opening_balance
 *    - âœ… Retourne criticalMessage si red_triggered
 * 
 * 2. createTreasuryCard(data, status, decisionId) [ligne ~589]
 *    - âœ… GÃ¨re data.error avec messages spÃ©cifiques
 *    - âœ… GÃ¨re data = null avec message par dÃ©faut
 *    - âœ… Affiche donnÃ©es si valides
 *    - âœ… Bouton "Examiner la dÃ©cision" si red_triggered
 *    - âœ… Classes visuelles card-critical, card-warning
 * 
 * 3. loadTreasuryData() [ligne ~735]
 *    - âœ… DÃ‰JÃ€ FONCTIONNELLE (aucune modification)
 *    - Retourne null, { error: ... }, ou ForecastResponse
 * 
 * 4. examineRedDecision(entityType, entityId) [ligne ~942]
 *    - âœ… DÃ‰JÃ€ FONCTIONNELLE (aucune modification)
 *    - Appelle showTreasuryRedPanel() pour afficher modal
 * 
 * 5. showTreasuryRedPanel(data) [ligne ~989]
 *    - âœ… DÃ‰JÃ€ FONCTIONNELLE (aucune modification)
 *    - Modal avec dÃ©tails dÃ©ficit + options financement
 * 
 * Fichier : /ui/dashboard.html
 * 
 * 1. Template treasuryCardTemplate [ligne ~182]
 *    - âœ… DÃ‰JÃ€ PRÃ‰SENT (aucune modification)
 *    - Structure : header + metric-primary + metric-grid + card-actions + card-error
 *    - Bulle d'aide : data-help avec texte mÃ©tier
 * 
 * 2. Zones cockpit [ligne ~119-160]
 *    - âœ… DÃ‰JÃ€ PRÃ‰SENTES (aucune modification)
 *    - zoneCritical, zoneTension, zoneNormal, zoneAnalysis
 * 
 * Fichier : /ui/styles.css
 * 
 * - âœ… AUCUNE MODIFICATION (respect strict du design)
 * - Toutes les classes nÃ©cessaires sont dÃ©jÃ  dÃ©finies :
 *   â€¢ .card-critical, .card-warning
 *   â€¢ .metric-value, .metric-small-value
 *   â€¢ .positive, .negative
 *   â€¢ .card-error
 *   â€¢ .cockpit-critical-view
 *   â€¢ .critical-metric, .critical-details, .critical-actions
 * 
 * ==========================================
 * VALIDATION FONCTIONNELLE
 * ==========================================
 * 
 * âœ… Appel GET /treasury/latest avec JWT + X-Tenant-ID
 * âœ… Affichage dans le cockpit (solde, prÃ©vision, Ã©tat)
 * âœ… RÃˆGLE CRITIQUE : Si ðŸ”´ â†’ Affichage UNIQUEMENT bloc TrÃ©sorerie
 * âœ… Pattern ðŸ”´ : Plan dominant activÃ© (vue exclusive)
 * âœ… Si ðŸŸ  ou ðŸŸ¢ : Affichage dans zone correspondante
 * âœ… Bulles d'aide â“˜ avec texte mÃ©tier clair
 * âœ… Gestion erreurs : API indisponible, DonnÃ©es absentes, AccÃ¨s refusÃ©
 * âœ… Respect strict du design premium (0 modification styles.css)
 * 
 * ==========================================
 * TESTS Ã€ EFFECTUER
 * ==========================================
 * 
 * 1. Cas normal (ðŸŸ¢) :
 *    - CrÃ©er forecast : opening_balance=50000, inflows=10000, outflows=5000
 *    - VÃ©rifier : forecast_balance=55000, red_triggered=false
 *    - RÃ©sultat : Carte en zoneNormal, statut ðŸŸ¢
 * 
 * 2. Cas tension (ðŸŸ ) :
 *    - CrÃ©er forecast : opening_balance=5000, inflows=2000, outflows=1000
 *    - VÃ©rifier : forecast_balance=6000, red_triggered=false
 *    - RÃ©sultat : Carte en zoneTension, statut ðŸŸ 
 * 
 * 3. Cas critique (ðŸ”´) :
 *    - CrÃ©er forecast : opening_balance=5000, inflows=2000, outflows=10000
 *    - VÃ©rifier : forecast_balance=-3000, red_triggered=true
 *    - RÃ©sultat : Vue exclusive en zoneCritical, bouton rapport RED
 * 
 * 4. Cas erreur API :
 *    - ArrÃªter le backend
 *    - RÃ©sultat : Message "Service indisponible" avec fond jaune
 * 
 * 5. Cas accÃ¨s refusÃ© :
 *    - Token invalide ou expirÃ©
 *    - RÃ©sultat : Message "AccÃ¨s refusÃ©" avec fond rouge
 * 
 * 6. Cas aucune donnÃ©e :
 *    - Aucun forecast crÃ©Ã© pour le tenant
 *    - RÃ©sultat : Message "Aucune donnÃ©e disponible"
 * 
 * ==========================================
 * COMMANDES DE TEST
 * ==========================================
 * 
 * # 1. CrÃ©er un forecast ðŸŸ¢
 * curl -X POST https://azalscore.onrender.com/treasury/forecast \
 *   -H "Authorization: Bearer {token}" \
 *   -H "X-Tenant-ID: {tenant}" \
 *   -H "Content-Type: application/json" \
 *   -d '{"opening_balance": 50000, "inflows": 10000, "outflows": 5000}'
 * 
 * # 2. CrÃ©er un forecast ðŸ”´
 * curl -X POST https://azalscore.onrender.com/treasury/forecast \
 *   -H "Authorization: Bearer {token}" \
 *   -H "X-Tenant-ID: {tenant}" \
 *   -H "Content-Type: application/json" \
 *   -d '{"opening_balance": 5000, "inflows": 2000, "outflows": 10000}'
 * 
 * # 3. RÃ©cupÃ©rer le dernier forecast
 * curl https://azalscore.onrender.com/treasury/latest \
 *   -H "Authorization: Bearer {token}" \
 *   -H "X-Tenant-ID: {tenant}"
 * 
 * ==========================================
 * CONCLUSION
 * ==========================================
 * 
 * âœ… IntÃ©gration complÃ¨te et fonctionnelle
 * âœ… Code exÃ©cutable immÃ©diatement
 * âœ… 0 modification de styles.css (respect design)
 * âœ… Gestion d'erreurs robuste
 * âœ… Pattern ðŸ”´ dominant opÃ©rationnel
 * âœ… Bulles d'aide mÃ©tier prÃ©sentes
 * âœ… Compatible avec l'architecture existante
 * 
 * Le cockpit est prÃªt pour production.
 */
